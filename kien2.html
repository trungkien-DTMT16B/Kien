<!DOCTYPE html>
<html lang="vi">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Thư viện Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <!-- Thư viện EraWidget -->
    <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>

    <style>
        .highcharts-figure .chart-container {
            width: 300px;
            height: 200px;
            float: left;
        }

        .highcharts-figure,
        .highcharts-data-table table {
            width: 600px;
            margin: 0 auto;
        }

        .highcharts-description {
            margin: 0.3rem 10px;
        }
    </style>
</head>

<body>
    <!-- Biểu đồ gauges tốc độ và RPM -->
    <figure class="highcharts-figure">
        <div id="container-speed" class="chart-container"></div>
        <div id="container-rpm" class="chart-container"></div>
        <p class="highcharts-description">
            Biểu đồ gauges với dữ liệu ngẫu nhiên hiển thị tốc độ và vòng quay mỗi phút (RPM).
        </p>
    </figure>

    <script>
        // Cấu hình chung cho các gauges
        const gaugeOptions = {
            chart: {
                type: 'solidgauge'
            },
            title: null,
            pane: {
                center: ['50%', '85%'],
                size: '140%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor: Highcharts.defaultOptions.legend.backgroundColor || '#fafafa',
                    borderRadius: 5,
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },
            yAxis: {
                stops: [
                    [0.1, '#55BF3B'],
                    [0.5, '#DDDF0D'],
                    [0.9, '#DF5353']
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                title: {
                    y: -70
                },
                labels: {
                    y: 16
                }
            },
            plotOptions: {
                solidgauge: {
                    dataLabels: {
                        y: 5,
                        borderWidth: 0,
                        useHTML: true
                    }
                }
            },
            tooltip: {
                enabled: false
            }
        };

        // Khởi tạo biểu đồ tốc độ
        const chartSpeed = Highcharts.chart('container-speed', Highcharts.merge(gaugeOptions, {
            yAxis: {
                min: 0,
                max: 200,
                title: {
                    text: 'Tốc độ'
                }
            },
            series: [{
                name: 'Tốc độ',
                data: [80],
                dataLabels: {
                    format: '<div style="text-align:center"><span style="font-size:25px">{y}</span><br/><span style="font-size:12px;opacity:0.4">km/h</span></div>'
                }
            }]
        }));

        // Khởi tạo biểu đồ RPM
        const chartRpm = Highcharts.chart('container-rpm', Highcharts.merge(gaugeOptions, {
            yAxis: {
                min: 0,
                max: 5,
                title: {
                    text: 'RPM'
                }
            },
            series: [{
                name: 'RPM',
                data: [1],
                dataLabels: {
                    format: '<div style="text-align:center"><span style="font-size:25px">{y:.1f}</span><br/><span style="font-size:12px;opacity:0.4">* 1000 / min</span></div>'
                }
            }]
        }));

        // Tạo dữ liệu ngẫu nhiên mỗi 2 giây cho tốc độ và RPM
        setInterval(function () {
            // Cập nhật tốc độ với giá trị ngẫu nhiên
            const speedPoint = chartSpeed.series[0].points[0];
            let newSpeedValue = Math.floor(Math.random() * 200);
            speedPoint.update(newSpeedValue);

            // Cập nhật RPM với giá trị ngẫu nhiên
            const rpmPoint = chartRpm.series[0].points[0];
            let newRpmValue = (Math.random() * 5).toFixed(1);
            rpmPoint.update(parseFloat(newRpmValue));
        }, 2000);

        // Cấu hình EraWidget
        const eraWidget = new EraWidget();
        eraWidget.init({
            needRealtimeConfigs: true,
            needHistoryConfigs: true,
            needActions: true,
            maxRealtimeConfigsCount: 3,
            maxHistoryConfigsCount: 1,
            maxActionsCount: 2,
            minRealtimeConfigsCount: 0,
            minHistoryConfigsCount: 0,
            minActionsCount: 0,
            onConfiguration: (configuration) => {
                console.log("Cấu hình từ server:", configuration);
            },
            onValues: (values) => {
                console.log("Giá trị hiện tại từ server:", values);
            },
        });
    </script>
</body>

</html>
